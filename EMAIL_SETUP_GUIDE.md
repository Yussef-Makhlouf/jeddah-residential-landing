# دليل إعداد البريد الإلكتروني - نظام إدارة مشروع الزهراء السكني

## نظرة عامة
هذا الدليل يوضح كيفية إعداد نظام البريد الإلكتروني لإرسال رسائل OTP (رمز التحقق) ورسائل الاستفسارات باستخدام البريد الإلكتروني `25_project@raf-advanced.sa` المستضاف على Hostinger.

## الإعدادات المطلوبة

### 1. متغيرات البيئة (.env.local)
```env
# إعدادات البريد الإلكتروني (Hostinger)
SMTP_HOST=mail.raf-advanced.sa
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=25_project@raf-advanced.sa
SMTP_PASS=25Project@raf
SMTP_FROM_NAME=نظام إدارة مشروع الزهراء السكني

# بريد المستلم
RECIPIENT_EMAIL=25_project@raf-advanced.sa
```

### 2. إعدادات Hostinger SMTP
- **الخادم**: `mail.raf-advanced.sa`
- **المنفذ**: `587` (TLS) أو `465` (SSL)
- **المصادقة**: مطلوبة
- **التشفير**: TLS/SSL

## الملفات المحدثة

### 1. `app/api/send-email/route.ts`
- تم تحديث إعدادات SMTP لاستخدام خادم Hostinger
- إضافة التحقق من صحة الإعدادات
- تحسين معالجة الأخطاء

### 2. `lib/email-service-alternative.ts`
- إضافة إعدادات متعددة لـ Hostinger (منافذ مختلفة)
- تحسين آلية المحاولة مرة أخرى
- إضافة تسجيل مفصل للأخطاء

### 3. `lib/email-config.ts` (جديد)
- ملف إعدادات مخصص للبريد الإلكتروني
- دوال للتحقق من صحة الإعدادات
- إعدادات إضافية لضمان التسليم

### 4. `lib/config.ts`
- تحديث الإعدادات الافتراضية لـ Hostinger

## اختبار النظام

### 1. اختبار إعدادات البريد الإلكتروني
```bash
npm run test-email
```

### 2. اختبار إرسال OTP
1. انتقل إلى صفحة "نسيت كلمة المرور"
2. أدخل بريد إلكتروني صحيح
3. تحقق من وصول رسالة OTP

### 3. اختبار إرسال الاستفسارات
1. انتقل إلى صفحة الاتصال
2. املأ النموذج وأرسله
3. تحقق من وصول الرسالة إلى `25_project@raf-advanced.sa`

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. فشل الاتصال بـ SMTP
```
خطأ: ECONNREFUSED
الحل: تأكد من صحة إعدادات SMTP_HOST و SMTP_PORT
```

#### 2. فشل المصادقة
```
خطأ: Invalid login
الحل: تأكد من صحة SMTP_USER و SMTP_PASS
```

#### 3. الرسائل لا تصل
```
الحلول:
- تحقق من مجلد Spam
- تأكد من إعدادات DNS (SPF, DKIM, DMARC)
- راجع سجلات Hostinger
```

### 4. رسائل OTP لا تصل
```
الحلول:
- تحقق من إعدادات RECIPIENT_EMAIL
- تأكد من أن البريد الإلكتروني نشط
- راجع سجلات النظام
```

## إعدادات DNS الموصى بها

### 1. سجل SPF
```
v=spf1 include:hostinger.com ~all
```

### 2. سجل DKIM
```
يتم إعداده من لوحة تحكم Hostinger
```

### 3. سجل DMARC
```
v=DMARC1; p=quarantine; rua=mailto:25_project@raf-advanced.sa
```

## مراقبة الأداء

### 1. سجلات النظام
```bash
# مراقبة سجلات Next.js
npm run dev

# مراقبة سجلات البريد الإلكتروني
tail -f logs/email.log
```

### 2. مؤشرات الأداء
- معدل نجاح الإرسال
- وقت الاستجابة
- عدد المحاولات الفاشلة

## الدعم الفني

### 1. سجلات الأخطاء
جميع الأخطاء مسجلة في وحدة التحكم مع تفاصيل كاملة.

### 2. اختبار الاتصال
```bash
# اختبار الاتصال بـ SMTP
npm run test-email

# اختبار قاعدة البيانات
npm run test-mongodb
```

### 3. التواصل
في حالة وجود مشاكل، يرجى:
1. مراجعة هذا الدليل
2. تشغيل اختبارات التشخيص
3. مراجعة سجلات النظام
4. التواصل مع فريق الدعم الفني

## التحديثات المستقبلية

### 1. إضافة دعم لخدمات بريد إلكتروني أخرى
### 2. تحسين آلية المحاولة مرة أخرى
### 3. إضافة مراقبة متقدمة للأداء
### 4. دعم القوالب المتقدمة

---

**ملاحظة**: تأكد من تحديث متغيرات البيئة في ملف `.env.local` قبل تشغيل النظام.