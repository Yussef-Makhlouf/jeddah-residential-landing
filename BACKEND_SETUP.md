# إعداد Backend - مشروع جدة السكني

## نظرة عامة

تم إنشاء backend لإرسال رسائل الحجز إلى بريد هوستنجر باستخدام Next.js API Routes و Nodemailer.

## الملفات المضافة

### 1. API Routes
- `app/api/send-email/route.ts` - لإرسال رسائل الحجز
- `app/api/health/route.ts` - للتحقق من حالة الخدمة

### 2. المكونات
- `components/ui/notification.tsx` - مكون التنبيهات والإشعارات

### 3. الملفات المحدثة
- `components/booking-modal.tsx` - تحديث لاستخدام API الجديد

## خطوات الإعداد

### 1. تثبيت المكتبات المطلوبة

```bash
npm install nodemailer @types/nodemailer
```

### 2. إعداد متغيرات البيئة

أنشئ ملف `.env.local` في مجلد المشروع الرئيسي:

```env
# إعدادات SMTP لـ Hostinger
SMTP_HOST=smtp.hostinger.com
SMTP_PORT=587
SMTP_USER=your-email@yourdomain.com
SMTP_PASS=your-app-password

# بريد المستلم (يمكن أن يكون نفس بريد المرسل أو بريد مختلف)
RECIPIENT_EMAIL=your-email@yourdomain.com
```

### 3. الحصول على كلمة مرور التطبيق من Hostinger

1. ادخل إلى لوحة تحكم Hostinger
2. اذهب إلى "Email" > "Manage"
3. اختر بريدك الإلكتروني
4. اذهب إلى "Security" > "App Passwords"
5. أنشئ كلمة مرور جديدة للتطبيق
6. استخدم هذه الكلمة في `SMTP_PASS`

## اختبار النظام

### 1. اختبار حالة الخدمة

```bash
curl http://localhost:3000/api/health
```

### 2. اختبار إرسال البريد

```bash
curl -X POST http://localhost:3000/api/send-email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "أحمد محمد",
    "phone": "0501234567",
    "notes": "أريد معلومات عن الشقق المتاحة"
  }'
```

### 3. اختبار من الواجهة

1. شغل المشروع: `npm run dev`
2. افتح نموذج الحجز
3. املأ البيانات وأرسل الطلب
4. تحقق من وصول البريد الإلكتروني

## ميزات النظام

### 1. التحقق من صحة البيانات
- التحقق من صحة رقم الجوال (تنسيق سعودي)
- التحقق من وجود البيانات المطلوبة

### 2. تصميم البريد الإلكتروني
- تصميم جميل ومتجاوب
- دعم اللغة العربية (RTL)
- ألوان متناسقة مع هوية المشروع

### 3. إدارة الأخطاء
- رسائل خطأ واضحة
- تنبيهات بصرية للمستخدم
- سجلات الأخطاء في وحدة التحكم

### 4. الأمان
- استخدام متغيرات البيئة
- التحقق من صحة البيانات المدخلة
- حماية من هجمات CSRF

## استكشاف الأخطاء

### مشاكل شائعة وحلولها

#### 1. خطأ في الاتصال بـ SMTP
```
Error: Invalid login
```
**الحل:** تحقق من صحة بيانات SMTP وكلمة مرور التطبيق

#### 2. البريد لا يصل
**الحلول:**
- تحقق من مجلد Spam
- تأكد من تفعيل SMTP في Hostinger
- تحقق من سجلات الخطأ

#### 3. خطأ في التطبيق
**الحلول:**
- تحقق من متغيرات البيئة
- أعد تشغيل الخادم
- تحقق من سجلات وحدة التحكم

## إعدادات الإنتاج

### 1. متغيرات البيئة للإنتاج

```env
NODE_ENV=production
SMTP_HOST=smtp.hostinger.com
SMTP_PORT=587
SMTP_USER=your-production-email@yourdomain.com
SMTP_PASS=your-production-app-password
RECIPIENT_EMAIL=your-production-email@yourdomain.com
```

### 2. تحسينات الأداء

- استخدام Redis للتخزين المؤقت
- ضغط الاستجابات
- تحسين استعلامات قاعدة البيانات

### 3. المراقبة

- إعداد سجلات الأخطاء
- مراقبة أداء API
- تنبيهات عند حدوث أخطاء

## الدعم

إذا واجهت أي مشاكل:

1. تحقق من سجلات الخطأ
2. تأكد من صحة الإعدادات
3. اختبر الاتصال بـ SMTP
4. راجع وثائق Hostinger

## التحديثات المستقبلية

- إضافة قاعدة بيانات لتخزين الطلبات
- نظام إدارة للطلبات
- إشعارات فورية (Push Notifications)
- تكامل مع أنظمة CRM
